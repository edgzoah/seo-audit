generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum AuditRunStatus {
  healthy
  watch
  critical
}

model User {
  id           String     @id @default(uuid()) @db.Uuid
  email        String     @unique
  passwordHash String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  auditRuns    AuditRun[]
}

model AuditRun {
  id          String         @id @default(uuid()) @db.Uuid
  runId       String         @unique
  displayName String?
  ownerUserId String         @db.Uuid
  owner       User           @relation(fields: [ownerUserId], references: [id], onDelete: Cascade)
  target      String
  domain      String?
  coverage    String
  startedAt   DateTime
  finishedAt  DateTime
  scoreTotal  Float
  pagesCrawled Int
  errors      Int
  warnings    Int
  notices     Int
  status      AuditRunStatus
  summaryJson Json
  reportJson  Json
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([startedAt(sort: Desc)])
  @@index([ownerUserId, startedAt(sort: Desc)])
  @@index([ownerUserId, runId])
  @@index([status, startedAt(sort: Desc)])
  @@index([coverage, startedAt(sort: Desc)])
  @@index([domain, startedAt(sort: Desc)])
  @@index([scoreTotal(sort: Desc)])
  @@index([target])
}

model AuditDiff {
  id            String   @id @default(uuid()) @db.Uuid
  baselineRunId String
  currentRunId  String
  diffJson      Json
  createdAt     DateTime @default(now())

  @@unique([baselineRunId, currentRunId])
  @@index([currentRunId])
}
